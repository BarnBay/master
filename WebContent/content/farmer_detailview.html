<script src="./js/star-rating.js"></script>
<link href="./css/star-rating.css" rel="stylesheet"/>


<script type="text/javascript">	
	var FarmerDetailJSONObject;
	var countProducts = 0;
	
	$.ajax({
		url: "/barnbay_ui/GetFarmerByFarmerId?id=" + $.cookie("Farmer.FarmerListCategoryID")
	}).done(function(data) {
		FarmerDetailJSONObject = JSON.parse(data);		
		farmerDetailFunction(FarmerDetailJSONObject);
		
		startMap(FarmerDetailJSONObject.street + ' ' + FarmerDetailJSONObject.number + ', ' + FarmerDetailJSONObject.zipcode + ' ' + FarmerDetailJSONObject.city, FarmerDetailJSONObject.farmname);
	});
</script>

<div class="row" id="farmerDetailInformation">
	<script type="text/javascript">
		function farmerDetailFunction(farmerDetailObject) {
			var out = "";
			
			out += '<div class="col-md-12" style="font-family: \'Roboto Condensed\', sans-serif;">';
			out += '	<div class="col-md-3">';
			out += '		<img src="./img/farmers/' + farmerDetailObject.firstname + ' ' + farmerDetailObject.lastname + '.png" alt="Image" class="img-circle center-block">';
			out += '		<h2>' + farmerDetailObject.firstname + ' ' + farmerDetailObject.lastname + '</h2>';
			out += '		<div class="text-center"><input id="farmerRating" type="text"></div>';
			out += '		<a class="btn btn-block btn-social btn-twitter">';
			out += ' 	 		<i class="fa fa-facebook"></i> Share via Facebook';
			out += '		</a>';
			out += '		<br/>';
			out += '		<div class="panel panel-success">';
			out += '			<div class="panel-heading">';
			out += '				<span class="glyphicon glyphicon-pushpin" aria-hidden="true"></span> Address';
			out += '			</div>';
			out += '			<div class="panel-body">';
			out += '				<address>';
			out += '					' + farmerDetailObject.street + ' ' + farmerDetailObject.number + '<br/>'
			out += '					' + farmerDetailObject.zipcode + ' ' + farmerDetailObject.city + '<br/>';
			out += '					' + farmerDetailObject.email + '<br/><br/>';
			out += '					<strong>Farm opening hours:</strong><br/>' + farmerDetailObject.farmopeninghours;
			out += '				</address>';
			out += '			</div>';
			out += '		</div>';
			out += '	</div>';
			out += '	<div class="col-md-9">';			
			out += '		<div style="width: 100%; height: 270px; overflow: hidden">';
			out += '			<img src="./img/farms/' + farmerDetailObject.farmname + '.png" alt="Image" class="img-responsive center-block" width="100%" height="350">';
			out += '		</div>';
			out += '		<div id="farmerDetailImageInfo">';
			out += '			<h4>' + farmerDetailObject.farmname + '</h4>';
			out += '			<p>' + farmerDetailObject.farmdescription + '</p>';
			out += '		</div>';
			out += '		<h3>Products</h3>';
			
			for(i = 0; i < farmerDetailObject.products.length; i++) {
				if(countProducts == 0) {
					out += '		<div class="row" id="category-row-1">';
				}
				/* ID UND NAME ANPASSEN !!!!!!!!!!!!!!!!!!!!!! */
				out += '		<div class="col-md-3">';
				out += '			<div class="panel panel-success" id="FarmerSingleProduct" style="cursor: pointer" onclick="farmerSwitchToProduct(' + farmerDetailObject.idfarmer + ', ' + farmerDetailObject.products[i].catid + ')">';
				out += '				<div class="panel-body">';
				out += '					<img src="./img/products/' + farmerDetailObject.products[i].name + '.png" alt="Image" class="img-responsive center-block" width="100" height="100">';
				out += '				</div>';
				out += '				<div class="panel-footer">';
				out += '					<h3 class="panel-title">' + farmerDetailObject.products[i].name + '</h3>';
				out += '				</div>';
				out += '			</div>';
				out += '		</div>';
								
				if(countProducts < 3) {
					countProducts++;
				} else {
					out += '		</div>';
					countProducts = 0;	
				}
			}
			
			out += '		<hr>';
			out += '		<div class="panel panel-success barnbays">';
			out += '			<div class="panel-heading">';
			out += '				<span class="glyphicon glyphicon-time" aria-hidden="true"></span> BarnBay pickup Locations';
			out += '			</div>';
			out += '			<div class="panel-body">';
			out += '				<table class="table table-striped">';
			out += '					<tr>';
			out += '						<th>Name</th>';
			out += '						<th>Zip Code</th>';
			out += '						<th>Address</th>';
			out += '						<th>Pick-Up Times</th>';
			out += '					</tr>';

			
			for(i = 0; i < farmerDetailObject.barnbays.length; i++) {
				out += '					<tr>';
				out += '						<td>' + farmerDetailObject.barnbays[i].name + '</td>';
				out += '						<td>' + farmerDetailObject.barnbays[i].address.zipcode + ' ' + farmerDetailObject.barnbays[i].address.city + '</td>';
				out += '						<td>' + farmerDetailObject.barnbays[i].address.street + ' ' + farmerDetailObject.barnbays[i].address.number + '</td>';
				out += '						<td>' + farmerDetailObject.barnbays[i].opening_hours + '</td>';
				out += '					</tr>';
			}
	
			out += '				</table>';
			out += '			</div>';
			out += '		</div>';
			out += '	</div>';
			out += '</div>';
			out += '<div class="col-md-12"><hr></div>';
			out += '<div class="col-md-12">';
			out += '	<div class="panel panel-success">';
			out += '		<div class="panel-heading">';
			out += '			<span class="glyphicon glyphicon-map-marker" aria-hidden="true"></span> Farmer Locations';
			out += '		</div>';
			out += '		<div class="panel-body">';
			out += '			<div id="map_farmer_canvas" style="width: 100%; height: 480px;"></div>';
			out += '		</div>';
			out += '	</div>';
			out += '</div>';
						
			document.getElementById("farmerDetailInformation").innerHTML = out;
			
			/* Set the Rating of the Ratingbar */
			$("#farmerRating").rating({
			    size: 'md',
			    readonly: true,
			    showCaption: false,
			    clearButton: ''
			});
			
			/* Set the Value of the Rating (3. Stars) */
			$('#farmerRating').rating('update', 3);	
		}
	</script>
	
</div>


<script type="text/javascript">
	function farmerSwitchToProduct(farmerid, productid) {
		$.cookie("Farmer.FarmerID", farmerid, { expires: 1 });
		$.cookie("Farmer.ProductID", productid, { expires: 1 });
	}
</script>

<!-- Google Maps Scripte -->
<script type="text/javascript">
	var geocoder, map;
	
	function startMap(address, title) {
		
 		var mapOptions = {
     		zoom: 15,
     		disableDefaultUI: true,
     	    mapTypeId: google.maps.MapTypeId.ROADMAP
    	}
 		
 	  	geocoder = new google.maps.Geocoder();
 	    map = new google.maps.Map(document.getElementById("map_farmer_canvas"), mapOptions);

 	  	geocoder.geocode({'address': address}, function(results, status) {
	 	  	if(status == google.maps.GeocoderStatus.OK) {
	 	  		map.setCenter(results[0].geometry.location);
	 	  		var marker = new google.maps.Marker({
	 	  			map: map,
	 	  			position: results[0].geometry.location
	 	  		});
	 	  		
	 	  		var infowindow = new google.maps.InfoWindow({
	 	  			content: '<div style="width: 150px;"><h4>' + title + '</h4></div>'
  	  	  		});
	 	  		
	 	  		google.maps.event.addListener(marker, 'click', function() {
					infowindow.open(map, marker);
				});
			} else {
	 	    	alert("Geocode was not successful for the following reason: " + status);
	 	   	}
		});
  	}
</script>