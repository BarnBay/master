<script type="text/javascript">
	var username = $.cookie('User.Username');
	
	$.ajax({
		type: "POST",
		url: "/barnbay_ui/GetAllOrdersByFarmerId",
		dataType : "json",
		data: JSON.stringify({
			"username":username
		}),
		success:function(data) {
			displayAllOrdersFromFarmer(sortJSON(sortJSON(data.delivery, "barnbay", true), "deliverydate", true));
		}, error: function(data) {
			
		}
	});
</script>


<div class="panel-group" id="newOrdersForFarmer" role="tablist" aria-multiselectable="true">

	<!-- Update View: New Orders -->
	<script type="text/javascript">
		function displayAllOrdersFromFarmer(allOrders) {
			var out = "";
			var newDate = "";
			var oldDate = "";
			var oldLocation = "";
			var altLocation = "";
			var dateDisplay = "";
			
			for(i = 0; i < allOrders.length; i++) {
				newDate = allOrders[i].deliverydate;
				newLocation = allOrders[i].barnbay;
				dateDisplay = allOrders[i].deliverydate.split("-");
				
				/* If the new date is unequal the old date, display a new panel */ 
				if(newDate != oldDate) {
					if(i != 0) {
						out += '					</tbody>';
						out += '				</table>';
						out += '			</div>';
						out += '		</div>';
						out += '	</div>';
						out += '	<br/>';
						
						oldLocation = "";
					}
					
					out += '	<div class="panel panel-success">';
					out += '		<div class="panel-heading" role="tab" id="headingOne">';
					out += '			<h4 class="panel-title">';
					out += '				<a data-toggle="collapse" data-parent="#accordion" href="#collapseOne' + i + '" aria-expanded="true" aria-controls="collapseOne' + i + '">';
					out += '					Next Pickup Orders for: <b>'+ getWeekdayFromDay(allOrders[i].deliverydate) + ', ' + dateDisplay[2] + '.' + dateDisplay[1] + '.' + dateDisplay[0] + '</b>';
					out += '				</a>';
					out += '			</h4>';
					out += '		</div>';
					out += '		<div id="collapseOne' + i + '" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">';
					out += '			<div class="panel-body">';
					
					oldDate = allOrders[i].deliverydate;
				}
				
				/* If the new location is unequal the old location, display a new table */ 
				if(newLocation != oldLocation) {
					if(i != 0 && newDate == oldDate) {
						out += '					</tbody>';
						out += '				</table>';
					}
					
					out += '				<table class="table table-hover">';
					out += '					<thead>';
					out += '						<tr>';
					out += '							<th></th>';
					out += '							<th>Productname</th>';
					out += '							<th class="text-center">Quantity</th>';
					out += '							<th class="text-center">Location<th>';
					out += '						</tr>';
					out += '					</thead>';
					out += '					<tbody>';
					
					oldLocation = allOrders[i].barnbay;
				}
				
				out += '						<tr>';
				out += '							<td class="col-sm-3 col-md-3 text-center" style="vertical-align: middle;"><img class="media-object" src="./img/products/' + allOrders[i].productcategory + '.png" style="width: 85px"></td>';
				out += '							<td class="col-sm-4 col-md-4" style="vertical-align: middle;">' + allOrders[i].productcategory + '</td>';
				out += '							<td class="col-sm-2 col-md-2 text-center" style="vertical-align: middle;">' + allOrders[i].amount + ' kg</td>';
				out += '							<td class="col-sm-3 col-md-3 text-center" style="vertical-align: middle;">' + allOrders[i].barnbay + '</td>';
				out += '						</tr>';
				
			}
	
			document.getElementById("newOrdersForFarmer").innerHTML = out;
		}
	</script>

</div>