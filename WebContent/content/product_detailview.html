<script type="text/javascript">
	//var GoogleMapsAddress = [];
	//var GoogleMapsTitle = [];
	
	var ProductDetailJSONObject;
	var ProductDetailName;
	var ProductPrice;
	var ProductDetailDescription;
	var ProductFarmerDescription;
	
	/* Shopping Cart */
	var obj = JSON.parse($.cookie('Products.ShoppingCart'));
	
	$.ajax({
		url: "/barnbay_ui/GetCheapestProduct?id=" + $.cookie("Product.ProductListCategoryID")
	}).done(function(data) {
		ProductDetailJSONObject = JSON.parse(data);
		ProductDetailName = ProductDetailJSONObject.name;
		ProductDetailDescription = ProductDetailJSONObject.description
		ProductFarmerDescription = ProductDetailJSONObject.farmerproductdescription;
		
		productDetailFunction(ProductDetailJSONObject);
		
		/* Start Google Maps */
		startMap(ProductDetailJSONObject.farmeraddress.street + ' ' + ProductDetailJSONObject.farmeraddress.number + ', ' + ProductDetailJSONObject.farmeraddress.zipcode + ' ' + ProductDetailJSONObject.farmeraddress.city, ProductDetailJSONObject.farmerfirstname + ' ' + ProductDetailJSONObject.farmerlastname);
	});
</script>

<div class="row">
	<div class="col-md-12">
		<div class="alert alert-success alert-block fade in" id="successAlert" style="display: none;">
			<button type="button" class="close" data-dismiss="alert">&times;</button>
			<h4>Success!</h4>
			<p>You successfully add the Product to your shopping-cart</p>
		</div>
	</div>
</div>

<!-- JSON - Create the Product List -->
<div class="row" id="productDetailInformation">
	<script type="text/javascript">							
		function productDetailFunction(productDetailObject) {			
			var out = "";
			
			out += '<div class="col-sm-12" style="font-family: \'Roboto Condensed\', sans-serif;">';
			out += '	<div class="col-sm-5">';
			out += '		<img src="./img/products/' + ProductDetailName + '.png" alt="Image" class="img-responsive center-block">';
			out += '	</div>';
			out += '	<div class="col-sm-7 productDetail">';
			out += '		<h2>' + ProductDetailName + '</h2>';
			out += '		<h5>' + ProductDetailDescription + '</h5>';
			out += '		<hr>';
			out += '		<div class="row manufacturer">';
			out += '			<div class="col-sm-2">';
			out += '				<span>Stock:</span>';
			out += '			</div>';
			out += '			<div class="col-sm-10">';
			out += '				' + productDetailObject.stock;
			out += '			</div>';
			out += '			<div class="col-sm-2">';
			out += '				<span>Description:</span>';
			out += '			</div>';
			out += '			<div class="col-sm-10">';
			out += '				' + ProductFarmerDescription;
			out += '			</div>';
			out += '		</div>';
			out += '		<hr>';
			out += '		<button type="button" class="btn btn-success pull-right" onclick="productAddToCart()">';
			out += '			<span class="glyphicon glyphicon-shopping-cart"></span> Add to Cart';
			out += '		</button>';
			out += '		<div class="price">';
			out += '			<span class="price-head">Price:</span>';
			out += '			<span class="price-new">' + productDetailObject.price + ' &euro;</span> ';
			ProductPrice = productDetailObject.price;
			out += '		</div>';
			out += '		<hr>';
			out += '		<div class="row productFamerLocation">';
			out += '			<div class="col-sm-2">';
			out += '				<span>Farmer:</span>';
			out += '			</div>';
			out += '			<div class="col-sm-10">';
			out += '				<select class="form-control input-md" id="selectproductDetailFarmer" onchange="productFarmerSelect(this)">';
			
			for(i = 0; i < productDetailObject.farmers.length; i++) {
				if((productDetailObject.farmerfirstname == productDetailObject.farmers[i].firstname) && (productDetailObject.farmerlastname == productDetailObject.farmers[i].lastname)) {
					out += '					<option value="' + productDetailObject.farmers[i].idfarmer + '" selected="selected">' + productDetailObject.farmers[i].firstname + ' ' + productDetailObject.farmers[i].lastname + '</option>';
				} else {
					out += '					<option value="' + productDetailObject.farmers[i].idfarmer + '">' + productDetailObject.farmers[i].firstname + ' ' + productDetailObject.farmers[i].lastname + '</option>';	
				}
			}
			
			out += '				</select>';
			out += '			</div>';
			out += '		</div>';
			out += '		<div class="row productFamerLocation">';
			out += '			<div class="col-sm-2">';
			out += '				<span>BarnBay:</span>';
			out += '			</div>';
			out += '			<div class="col-sm-10">';
			out += '				<select class="form-control input-md" id="selectproductDetailLocation">';
			
			for(i = 0; i < productDetailObject.barnbays.length; i++) {
				out += '					<option value="' + productDetailObject.barnbays[i].id + '">' + productDetailObject.barnbays[i].name + '</option>';	
			}
			
			out += '				</select>';
			out += '			</div>';
			out += '		</div>';
			out += '		<div class="row productFamerLocation">';
			out += '			<div class="col-sm-2">';
			out += '				<span>Quantity:</span>';
			out += '			</div>';
			out += '			<div class="col-sm-10">';
			out += '				<input type="number" class="form-control" id="exampleInputQuantity" placeholder="1 kg">';
			out += '			</div>';
			out += '		</div>';
			out += '	</div>';
			out += '	<br/>';
			out += '	<div class="col-sm-12" style="font-size: 16px">';
			out += '	<hr>';
			out += '		<div class="col-sm-4">';
			out += '			<div class="panel panel-success">';
			out += '				<div class="panel-heading">';
			out += '					<span class="glyphicon glyphicon-pushpin" aria-hidden="true"></span> Address';
			out += '				</div>';
			out += '				<div class="panel-body" style="padding-bottom: 0px;">';
			out += '					<address>';
			out += '						<strong>' + productDetailObject.farmerfirstname + ' ' + productDetailObject.farmerlastname + '</strong>';
			out += '						<br/>';
			out += '						' + productDetailObject.farmeraddress.street + ' ' + productDetailObject.farmeraddress.number;
			out += '						<br/>';
			out += '						' + productDetailObject.farmeraddress.zipcode + ' ' + productDetailObject.farmeraddress.city;
			out += '						<br/>';
			out += '						Telefon';
			out += '						<br/>';
			out += '						Email';
			out += '					</address>';
			out += '				</div>';
			out += '			</div>';
			out += '		</div>';
			out += '		<div class="col-sm-8">';
			out += '			<div class="panel panel-success">';
			out += '				<div class="panel-heading">';
			out += '					<span class="glyphicon glyphicon-time" aria-hidden="true"></span> BarnBay pickup Locations';
			out += '				</div>';
			out += '				<div class="panel-body">';
			out += '					<table class="table table-striped">';
			out += '						<tr>';
			out += '							<th>Name of the Location</th>';
			out += '							<th>Description</th>';
			out += '							<th>Pick-Up Times</th>';
			out += '						</tr>';

			for(i = 0; i < productDetailObject.barnbays.length; i++) {
				out += '						<tr>';
				out += '							<td>' + productDetailObject.barnbays[i].name + '</td>';
				out += '							<td>' + productDetailObject.barnbays[i].description + '</td>';
				out += '							<td>' + productDetailObject.barnbays[i].opening_hours + '</td>';
				out += '						</tr>';
			}
	
			out += '					</table>';
			out += '				</div>';
			out += '			</div>';
			out += '		</div>';
			out += '		<br/>';
			out += '	</div>';
			out += '	<br/>';
			out += '	<div class="col-sm-12" style="font-size: 16px">';
			out += '		<div class="col-sm-12">';
			out += '			<div class="panel panel-success">';
			out += '				<div class="panel-heading">';
			out += '					<span class="glyphicon glyphicon-time" aria-hidden="true"></span> BarnBay pickup Locations';
			out += '				</div>';
			out += '				<div class="panel-body">';
			out += '					<div id="map_canvas" style="width: 100%; height: 480px;"></div>';
			out += '				</div>';
			out += '			</div>';
			out += '		</div>';
			out += '	</div>';
			out += '</div>';
			
			document.getElementById("productDetailInformation").innerHTML = out;
		}
	</script>
</div>

<script type="text/javascript">
	function productFarmerSelect(element) {
		$.ajax({
			url: "/barnbay_ui/GetProductByCategoryAndFarmer?catid=" + $.cookie("Product.ProductListCategoryID") + "&farmerid=" + element.value
		}).done(function(data) {
			ProductDetailJSONObject = JSON.parse(data);
			ProductFarmerDescription = ProductDetailJSONObject[0].description;
			
			productDetailFunction(ProductDetailJSONObject[0]);
			
			/* Start Google Maps */
			startMap(ProductDetailJSONObject[0].farmeraddress.street + ' ' + ProductDetailJSONObject[0].farmeraddress.number + ', ' + ProductDetailJSONObject[0].farmeraddress.zipcode + ' ' + ProductDetailJSONObject[0].farmeraddress.city, ProductDetailJSONObject[0].farmerfirstname + ' ' + ProductDetailJSONObject[0].farmerlastname);
		});
	}
	
	function productAddToCart() {
		if($.cookie('User.Session')) {
			var productID = $.cookie("Product.ProductListCategoryID");
			var productName = ProductDetailName;
			var productPrice = ProductPrice;
			var productQuantity = $("#exampleInputQuantity").val();
			var farmerID = $("#selectproductDetailFarmer option:selected").text();
			var farmerName = $("#selectproductDetailFarmer option:selected").val();
			var barnbayID = $("#selectproductDetailLocation option:selected").text();
			var barnbayName = $("#selectproductDetailLocation option:selected").val();
			
			obj['shoppingcart'].push({"productID":productID,"productName":productName,"productPrice":productPrice,"productQuantity":productQuantity,"farmerID":farmerID,"farmerName":farmerName,"barnbayID":barnbayID,"barnbayName":barnbayName});			
			$('#successAlert').slideDown();
		} else {
			$('#productAddToCartLogin').modal('show'); 	
		}
	}
	
</script>

<!-- Modal Login -->
<div class="modal fade" id="productAddToCartLogin" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
  			<div class="modal-header">
    			<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
    			<h4 class="modal-title" id="myModalLabel">Please Login</h4>
  			</div>
  			<div class="modal-body">
    			If you want to add some Products to you Shopping-Card you must Login
  			</div>
  			<div class="modal-footer">
    			<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
  			</div>
		</div>
	</div>
</div>

<!-- Google Maps Scripte -->
<script type="text/javascript">
	var markerBounds, geocoder, map;
	
 	function startMap(address, title) {
 		var mapOptions = {
     		zoom: 12,
     		disableDefaultUI: true,
     	    mapTypeId: google.maps.MapTypeId.ROADMAP
    	}
 		
 	  	geocoder = new google.maps.Geocoder();
 		markerBounds = new google.maps.LatLngBounds();
 	    map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
 	    
 	    
 	  	geocoder.geocode({'address': address}, function(results, status) {
	 	  	if(status == google.maps.GeocoderStatus.OK) {
	 	  		map.setCenter(results[0].geometry.location);
	 	  		var marker = new google.maps.Marker({
	 	  			map: map,
	 	  			position: results[0].geometry.location
	 	  		});
	 	  		
	 	  		var infowindow = new google.maps.InfoWindow({
  	  	    		content: '<div><h3>' + title + '</h3></div>'
  	  	  		});
	 	  		
	 	  		google.maps.event.addListener(marker, 'click', function() {
					infowindow.open(map, marker);
				});
	 	  		
	 	  		markerBounds.extend(results[0].geometry.location);
				map.fitBounds(markerBounds);
			} else {
	 	    	alert("Geocode was not successful for the following reason: " + status);
	 	   	}
		});
  	}
 	
 	/*function addMarkerToMap() {
 		startMap();
 		
 		for (var i = 0; i < GoogleMapsAddress.length; i++) {
 			var address = GoogleMapsAddress[i];
 			var title = '<h2 id="firstHeading" class="firstHeading">' + GoogleMapsTitle[i] + '</h2>';
 			
	 		geocoder.geocode({'address': address}, function(results, status) {
	 			if(status == google.maps.GeocoderStatus.OK) {	    	  				
	 				var marker = new google.maps.Marker({
	 					map: map,
						title: title,
						position: results[0].geometry.location
					});
					
					var infowindow = new google.maps.InfoWindow({
	  	  	    		content: title
	  	  	  		});
										
					google.maps.event.addListener(marker, 'click', function() {
						infowindow.open(map, marker);
					});
					
					markerBounds.extend(results[0].geometry.location);
					map.fitBounds(markerBounds);
				} else {
	      			alert("Geocode was not successful for the following reason: " + status);
	    		}
			});
 		}
 	}*/
 </script>