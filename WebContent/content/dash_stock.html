<script type="text/javascript">
	var JSONUserObject = JSON.parse($.cookie('User.JSON'));
	var pId = new Array();
	
	$.ajax({
		url: "/barnbay_ui/GetAllProductsByFarmerId?id=" + JSONUserObject.id
	}).done(function(data) {
		displayAllFarmerProducts(JSON.parse(data));
	});
	
	$.ajax({
		url: "/barnbay_ui/GetAllSubCategories"
	}).done(function(data) {
		displayAllProductCategroys(JSON.parse(data));
	});
</script>

<h2></h2>

<div class="row">
	<div class="col-md-12">
		<div class="alert alert-success alert-block fade in" id="successAddProduct" style="display: none;">
			<button type="button" class="close" data-dismiss="alert">&times;</button>
			<h4>Successfully!</h4>
			<p>You successfully add a new Product to your Stock</p>
		</div>
	</div>
</div>

<h2>Update actual stock!</h2>
<form id="formUpdateProductTable" accept-charset="utf-8" role="form">
	<table id="stockProductTable" class="table table-hover">
	
	</table>
</form>

<h2>Add new Products to your stock!</h2>
<form id="formAddProductTable" accept-charset="utf-8" role="form">
	<table id="stockAddProductTable" class="table table-hover">

	</table>
</form>


<!-- Update Table: stockProductTable -->
<script type="text/javascript">
	function displayAllFarmerProducts(farmerProducts) {
		var out = "";
		
		out += '		<thead>';
		out += '			<tr>';
		out += '				<th class="col-md-1 text-center"></th>';
		out += '				<th class="col-md-2 text-center">Productname</th>';
		out += '				<th class="col-md-1 text-center">Quantity</th>';
		out += '				<th class="col-md-2 text-center">Update Quantity</th>';
		out += '				<th class="col-md-1 text-center">Price</th>';
		out += '				<th class="col-md-2 text-center">Update Price</th>';
		out += '				<th class="col-md-3 text-center">Description</th>';
		out += '			</tr>';
		out += '		</thead>';
		out += '		<tbody id="stockUpdateTable">';
		
		pId = [];
		for(i = 0; i < farmerProducts.length; i++) {
			pId.push(farmerProducts[i].id);
			
			out += '			<tr>';
			out += '				<td class="text-center" style="vertical-align: middle;">';
			out += '					<button type="button" class="btn btn-danger" onClick="removeItemFromStock(' + farmerProducts[i].id + ')">';
			out += '						<span class="glyphicon glyphicon-remove"></span>';
			out += '					</button>';
			out += '				</td>';
			out += '				<td style="vertical-align: middle;">' + farmerProducts[i].name + '</td>';
			out += '				<td class="text-center" style="vertical-align: middle;">' + farmerProducts[i].stock + '</td>';
			out += '				<td style="vertical-align: middle;"><input type="number" class="form-control farmerProductStock" maxlength="4" value="' + farmerProducts[i].stock + '" placeholder="' + farmerProducts[i].stock + '"></td>';
			out += '				<td class="text-center" style="vertical-align: middle;">' + (farmerProducts[i].price).toFixed(2) + ' &euro;</td>';
			out += '				<td style="vertical-align: middle;"><input type="number" class="form-control farmerProductPrice" value="' + (farmerProducts[i].price).toFixed(2) + '" placeholder="' + (farmerProducts[i].price).toFixed(2) + ' &euro;"></td>';
			out += '				<td style="vertical-align: middle;"><textarea class="form-control farmerProductDescription" rows="2" placeholder="' + farmerProducts[i].description + '">' + farmerProducts[i].description + '</textarea></td>';
			out += '			</tr>';
		}
		
		out += '			<tr>';
		out += '				<td></td>';
		out += '				<td></td>';
		out += '				<td></td>';
		out += '				<td></td>';
		out += '				<td></td>';
		out += '				<td></td>';
		out += '				<td>';
		out += '					<button type="submit" id="updateFarmerProduct" class="btn btn-block btn-success">';
		out += '						<span class="glyphicon glyphicon-saved"></span> Update stock';
		out += '					</button>';
		out += '				</td>';
		out += '			</tr>';
		out += '		</tbody>';
		
		document.getElementById("stockProductTable").innerHTML = out;
	}
</script>

<!-- Update Table: stockProductTable -->
<script type="text/javascript">
	function displayAllProductCategroys(ProductCategories) {
		var out = "";
		
		out += '		<thead>';
		out += '			<tr>';
		out += '				<th class="col-md-3 text-center">Productname</th>';
		out += '				<th class="col-md-3 text-center">Quantity</th>';
		out += '				<th class="col-md-3 text-center">Price in Euro</th>';
		out += '				<th class="col-md-3 text-center">Description</th>';
		out += '			</tr>';
		out += '		</thead>';
		out += '		<tbody>';
		out += '			<tr>';
		out += '				<td style="vertical-align: middle; class="col-md-2">';
		out += '					<select class="form-control input-md farmerAddProductCategory">';
		
		for(i = 0; i < ProductCategories.length; i++) {
			out += '						<option value="' + ProductCategories[i].idcategory + '">' + ProductCategories[i].name + '</option>';	
		}
		
		out += '					</select>';
		out += '				</td>';
		out += '				<td style="vertical-align: middle;"><input type="number" class="form-control farmerAddProductStock" maxlength="4" required /></td>';
		out += '				<td style="vertical-align: middle;"><input type="number" class="form-control farmerAddProductPrice" min="0" max="9999" step="0.01" required /></td>';
		out += '				<td style="vertical-align: middle;"><textarea class="form-control farmerAddProductDescription" rows="2" required /></textarea></td>';
		out += '			</tr>';
		out += '			<tr>';
		out += '				<td></td>';
		out += '				<td></td>';
		out += '				<td></td>';
		out += '				<td align="right">';
		out += '					<button type="submit" id="AddFarmerProduct" class="btn btn-block btn-success">';
		out += '						<span class="glyphicon glyphicon-saved"></span> Add Product';
		out += '					</button>';
		out += '				</td>';
		out += '			</tr>';
		out += '		</tbody>';
		
		
		document.getElementById("stockAddProductTable").innerHTML = out;
	}
</script>

<!-- Check if update Button was clicked -->
<script type="text/javascript">
	$("#formUpdateProductTable").submit(function(event) {
		event.preventDefault();
		
		var obj = JSON.parse('{"product":[]}');
		
		var result = new Array();
		var pStock = new Array();
		var pPrice = new Array();
		var pDescription = new Array();
		
		$('#stockUpdateTable').find('.farmerProductStock').each(function() {
			pStock.push(this.value);
		});
		
		$('#stockUpdateTable').find('.farmerProductPrice').each(function() {
			pPrice.push(this.value);
		});
		
		$('#stockUpdateTable').find('.farmerProductDescription').each(function() {
			pDescription.push(this.value);
		});
		
		for(i = 0; i < pStock.length; i++) {
			obj['product'].push({"Id":pId[i],"Stock":pStock[i],"Price":pPrice[i],"Description":pDescription[i]});
		}
		
		$.ajax({
			type: "POST",
			url: "/barnbay_ui/UpdateFarmerProductStock",
			dataType : "json",
			data: JSON.stringify(obj),
			success:function(data) {
				/* Update View */
				$.ajax({
					url: "/barnbay_ui/GetAllProductsByFarmerId?id=" + JSONUserObject.id
				}).done(function(data) {
					displayAllFarmerProducts(JSON.parse(data));
				});	
			}, error: function(data) {
				//Do nothing!
			}
		});
	});
</script>

<!-- Remove Product from Stock -->
<script type="text/javascript">
	function removeItemFromStock(id) {
		$.ajax({
			url: "/barnbay_ui/RemoveProductFromStockByFarmerId?id=" + id
		}).done(function(data) {
			/* Update View */
			$.ajax({
				url: "/barnbay_ui/GetAllProductsByFarmerId?id=" + JSONUserObject.id
			}).done(function(data) {
				displayAllFarmerProducts(JSON.parse(data));
			});
		});
	}
</script>

<!-- Add Product to Database -->
<script type="text/javascript">
	$("#formAddProductTable").submit(function(event) {
		event.preventDefault();
		
		$.ajax({
			type: "POST",
			url: "/barnbay_ui/AddProductToFarmerStock",
			dataType : "json",
			data: JSON.stringify({
				"categoryid":$('.farmerAddProductCategory').val(),
				"productstock":$('.farmerAddProductStock').val(),
				"productprice":$('.farmerAddProductPrice').val(),
				"productdescription":$('.farmerAddProductDescription').val(),
				"userid":JSONUserObject.id
			}),
			success:function(data) {
				$('#successAddProduct').slideDown();
				
				/* Update View */
				$.ajax({
					url: "/barnbay_ui/GetAllProductsByFarmerId?id=" + JSONUserObject.id
				}).done(function(data) {
					displayAllFarmerProducts(JSON.parse(data));
				});
			}, error: function(data) {
				//Do nothing!
			}
		});
	});
</script>